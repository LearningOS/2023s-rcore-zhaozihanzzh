## 编程作业

重写了 sys_get_time、sys_task_info，实现了 mmap 和 munmap 匿名映射。

## 荣誉准则

在完成本次实验的过程（含此前学习的过程）中，我曾分别与 以下各位 就（与本次实验相关的）以下方面做过交流，还在代码中对应的位置以注释形式记录了具体的交流对象及内容：

《你交流的对象说明》

此外，我也参考了 以下资料 ，还在代码中对应的位置以注释形式记录了具体的参考来源及内容：

https://github.com/LearningOS/rCore-Tutorial-Code-2022S/pull/4

3. 我独立完成了本次实验除以上方面之外的所有工作，包括代码与文档。 我清楚地知道，从以上方面获得的信息在一定程度上降低了实验难度，可能会影响起评分。

4. 我从未使用过他人的代码，不管是原封不动地复制，还是经过了某些等价转换。 我未曾也不会向他人（含此后各届同学）复制或公开我的实验代码，我有义务妥善保管好它们。 我提交至本实验的评测系统的代码，均无意于破坏或妨碍任何计算机系统的正常运转。 我清楚地知道，以上情况均为本课程纪律所禁止，若违反，对应的实验成绩将按“-100”分计。

## 问答作业

参考了 RISC-V-Reader-Chinese-v2p1.pdf。

SV39 页表项组成：

63-54 保留 53-28 ```PPN[2]``` 27-19 ```PPN[1]``` 18-10 ```PPN[0]``` 9-8 ```OS用，硬件不管它``` 7 ```Dirty``` 6 ```Accessed``` 5 ```Global``` 4 ```User``` 3 ```eXecution``` 2 ```Write``` 1 ```Read``` 0 ```Valid```

我觉得缺页可能导致 StoreFault，StorePageFault，LoadFault，LoadPageFault。

此时，```mideleg``` 描述哪些中断委托给 S 模式，```sepc``` 保存产生异常的 PC 值，PC 被设置为 ```stvec```。

Lazy 节约空间，避免同时加载大量资源。

10GiB 连续内存页面，10GiB 约 2^33 B，共有 2^21 页（每页 4KiB），每个页表项 2^3B，1 级页表需要 2^24B，占用 2^12页；2 级页表有 2^12 个页表项，占 2^3 页，3 级页表有 2^3 个页表项，1 页足够了，总共需要大约 2^12+2^3+1 页，大约 16MiB 多。

我觉得应该维护一个表，记录下应用提交了多少申请还没被实际分配，缺页时去查表并更新。

我觉得失效可能体现在 Valid 位和操作系统用的那几位上。

单页表情况下，把内核部分应该设成全局的，保存 TaskContext 到特定位置后借助跳板切换页表。

可以设置页表项的 ```U``` 位为 0 使得用户态无法访问。

单页表中，系统调用实现更简单，仅仅进行系统调用时无需切换多级页表系统。

双页表下，切换进程和切换内核态、用户态时。我觉得单页表时，切换进程时更换页表。